<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Olaf</title>
	<link rel="icon" href="./Immagini_def/Favicon 16x16.png" type="image/png" />

    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>

    <style type="text/css">

        body {margin: 0px auto;
			  background-image: url("Immagini_def/Pattern.png");
			  background-size: cover;
		      overflow: auto;
			  }
    </style>
</head>
<body>

<script type="text/javascript">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Olaf</title>
    <script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>

    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1024, 768, Phaser.AUTO, 'La Storia di Olaf', { preload: preload, create: create, update: update, render: render });



function preload() {

    game.load.audio('olafspuntonato', 'sound effects/olafspuntonato.wav');
    game.load.audio('blink', 'sound effects/fiocco.wav');
    game.load.audio('palla', 'sound effects/palla.wav');
    game.load.audio('cubetto', 'sound effects/ghiacciato.wav');
    game.load.audio('ciff', 'sound effects/PassiOlaf.wav');
    game.load.audio('secco', 'sound effects/camminataolafsecca.wav');
    game.load.audio('fruscio', 'sound effects/livello1.wav');
    game.load.audio('castle', 'sound effects/castello.wav');
    game.load.audio('sfida', 'sound effects/Elsa.wav');
    game.load.audio('musicacheckpoint', 'sound effects/musicacheckpoint.wav');
    game.load.audio('cadutaterre', 'sound effects/cadutaterre.wav');
    game.load.audio('suononeve', 'sound effects/suono_neve.wav');
    game.load.audio('suonolago', 'sound effects/suono_lago.wav');
    game.load.audio('muromattoni', 'sound effects/muromattoni.wav');


    game.load.image('numero_vita_5', './assets/x5.png',95,62);
    game.load.image('numero_vita_4', './assets/x4.png',95,62);
    game.load.image('numero_vita_3', './assets/x3.png',95,62);
    game.load.image('numero_vita_2', './assets/x2.png',95,62);
    game.load.image('numero_vita_1', './assets/x1.png',95,62);
    game.load.image('numero_vita_0', './assets/x0.png',95,62);
    game.load.spritesheet('bottone_uscita_gioco', './assets/tastohome.png', 960,560);

    //Sfondi primo livello
    game.load.image('livello1_a', './assets/Cielo_def_def.png');
    game.load.image('livello1_b', './assets/Montagne.png');
    game.load.image('livello1_c', './assets/Montagne Piccola.png');
    game.load.image('livello1_d', './assets/Colline_1.png');
    game.load.image('nebbia', './assets/nebbia_def.png');

    //Sfondi secondo e terzo livello
    game.load.image('livello2_a', './assets/Sfondo con finestre_def.png');
    game.load.image('livello2_b', './assets/Colonnato in secondo piano_def.png');
    game.load.image('livello3_a', './assets/Sfondo grigio terzo livello.png');
    game.load.image('livello3_b1', './assets/Colonnato ombreggiato.png');
    game.load.image('livello3_b', './assets/Colonnato fermo.png');
    game.load.image('livello2_c', './assets/Colonnato in primo piano_nuovo.png');
    game.load.image('ponte_levatoio', './assets/ponte.png');
    game.load.image('catena', './assets/Catena_def.png');

    //Piattaforme primo livello
    game.load.image('piattfo1', './assets/Prima Piattaforma.png');
    game.load.image('piattfo2', './assets/Seconda Piattaforma.png');
    game.load.image('piattfo3', './assets/Terza Piattaforma.png');
    game.load.image('piattfo4', './assets/Quarta Piattaforma.png');
    game.load.image('piattfo5', './assets/Quinta Piattaforma.png');
    //Piattaforme secondo e terzo livello
    game.load.image('piattfo6', './assets/a_tavola.png');
    game.load.image('piattfo7', './assets/b_tavola.png');
    game.load.image('piattfo8', './assets/c_tavola.png');
    game.load.image('piattfo9', './assets/d_tavola.png');
    game.load.image('piattfo10', './assets/e_tavola.png');
    game.load.image('piattfo11', './assets/e_tavola.png');

    //Trono
    game.load.image('trono_sotto', './assets/Parte Sotto Trono con Cuscino.png');
    game.load.image('trono_sopra', './assets/Parte Sopra Trono con Cuscino.png');

    //Piattaforme trasparenti primo livello
    game.load.image('ground1', './assets/Piattaforma-Base-1.png');
    game.load.image('ground2', './assets/Seconda-Piattaforma-Base.png');
    game.load.image('ground3', './assets/Terza-Piattaforma-Base.png');
    game.load.image('ground4', './assets/Querta-Piattaforma-Base.png');
    game.load.image('ground5', './assets/Quinta-Piattaforma-Base.png');
    //Piattaforme trasparenti secondo e terzo livello
    game.load.image('ground6', './assets/Piattaforma1SecondoLivello.png');
    game.load.image('ground7', './assets/Piattaforma2SecondoLivello.png');
    game.load.image('ground8', './assets/Piattaforma3SecondoLivello.png');
    game.load.image('ground9', './assets/Piattaforma4SecondoLivello.png');
    game.load.image('ground10', './assets/Piattaforma5SecondoLivello.png');
    game.load.image('ground11', './assets/Piattaforma5SecondoLivello.png');
    //Piattaforme volanti
    game.load.image('sospesa3_f', './assets/Piattaforma volante terzo livello.png');
    game.load.image('sospesa2_f', './assets/Piattaforma di pietra.png');
    game.load.image('sospesa_f', './assets/Piattaforma Fissa Livello 1.png');
    game.load.spritesheet('sospesa_m', './assets/Piattaforma terra.png', 253, 79);
    game.load.spritesheet('sospesa2_m', './assets/Piattaforma cemento.png', 253, 79);

    game.load.image('mattone', './assets/mattone-nuovo.png');
    game.load.image('muro','./assets/stop.png');

    game.load.image('neve','./assets/palla.png');
    game.load.image('proiettile_elsa','./assets/Proiettile elsa_def.png');
    game.load.image('cubetto_ghiaccio','./assets/ice.png');
    game.load.image('bullets', './assets/Fiocco-di-neve-singolo-bagliore-nero-54x58.png');
    game.load.spritesheet('fiocco', './assets/Fiocco-di-Neve-con-bagliore-bianco.png', 150, 170);
    //game.load.spritesheet('ciapa', './assets/Fiocco di Neve Animazione.png', 150, 170);

    game.load.spritesheet('vita', './assets/Barra-di-scioglimento-232x24-no-spazio.png', 232, 24);
    game.load.spritesheet('olaf', './assets/olaf64x120copiaa.png', 64, 120);
    game.load.spritesheet('elsa', './assets/elsa giusta.png', 54, 141);
    game.load.spritesheet('nemico','./assets/Guardia.png', 90, 150);
    game.load.spritesheet('check-point','./assets/Bandierina-azzurrina-110x226.png', 110, 226);

    game.load.spritesheet('lampadario','./assets/Lampadario190x165.png', 190, 165);
    game.load.spritesheet('lampadario_cadente','./assets/Stalattite.png',143,176);
    game.load.image('rovi', './assets/Rovo 101x51.png');
    game.load.image('spuntoni', './assets/Spuntoni Dentati.png');
    game.load.spritesheet('torcia', './assets/Torcia-140x160.png', 140, 160);
    game.load.spritesheet('acqua_onde', './assets/onde con pezzetti.png',1024,101);
    game.load.spritesheet('tastoinfo1', './assets/tastoinfo1_def.png',195,95);
    game.load.spritesheet('tastoinfo2', './assets/tastoinfo2_def.png',317,80);
    game.load.spritesheet('tastoinfo3', './assets/tastoinfo3_def.png',90,84);
    game.load.spritesheet('tastoinfo4', './assets/tastoinfo4_def.png',84,84);

    game.load.image('icona_olaf', './assets/Mini Olaf.png',45,96);
    game.load.image('icona_elsa', './assets/Elsa-mini.png',45,96);
    game.load.image('corona', './assets/corona bagliore.png',100,82);
}



    //Variabili suoni
    var blink;
    var palla;
    var ciff;
    var win;
    var cadutaterre;
    var secco;
    var olafspuntonato;
    var musicacheckpoint;
    var ambience1;
    var ambience2;
    var ambience3;
    var suononeve;
    var suonolago;
    var muromattoni;
    //Variabili elementi
    var lampadario;
    var lampadario1;
    var lampadario2;
    var lampadario3;
    var lampadario4;
    var lampadario5;
    var lampadario6;
    var lampadario7;
    var stalattite;
    const lampadario_cadente = [0,1];
    const lampadario_cadente_ascisse = [12570,14598];
    const lampadario_cadente_ordinate = [100,100];
    var stalattiti;
    var rovi;
    var spuntoni;
    var piattfo1;
    var piattfo2;
    var piattfo3;
    var piattfo4;
    var piattfo5;
    var piattfo6;
    var piattfo7;
    var piattfo8;
    var piattfo9;
    var piattfo10;
    var piattfo11;

    //var ciapi;
    //const ciapa = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];
    //const ciapa_ascisse = [516, 1060, 1536, 2043, 4078, 4968, 6699, 7579, 9288, 9288, 10650, 12566, 13565, 15420, 16000, 17223, 18184, 18961];
    //const ciapa_ordinate = [590, 480, 415, 590, 590, 605, 468, 190, 306, 560, 590, 590, 295, 590, 590, 290, 370, 590];

    var tastoinfo1;
    var tastoinfo2;
    var tastoinfo3;
    var tastoinfo4;
    var torcia1;
    var torcia2;
    var torcia3;
    var torcia4;
    var torcia5;
    var acqua;

    var j = 0;
    var corona;
    var intervallo_creazione_mattoni = 30;
    var mattoni;
    var mattone;
    var posizione_mattone;
    var numero_mattoni_da_creare = 20;
    var numero_mattoni_creati = 0;
    var muro_creato = 0;
    var muro;
    var trono_sotto;
    var trono_sopra;
    var url_exit = 'home.html';
    var url_gameover = 'sconfitta.html';
    var url_endgame = 'vittoria.html';
    var icona_vita_olaf;
    var numero_vita_olaf_5;
    var numero_vita_olaf_4;
    var numero_vita_olaf_3;
    var numero_vita_olaf_2;
    var numero_vita_olaf_1;
    var numero_vita_olaf_0;
    var icona_vita_elsa;
    var numero_vita_elsa_5;
    var numero_vita_elsa_4;
    var numero_vita_elsa_3;
    var numero_vita_elsa_2;
    var numero_vita_elsa_1;
    var numero_vita_elsa_0;
    var bottone_uscita_gioco;
    var livello_gioco = 0;
    var text;
    var piattaforme_fisse;
    var ponte;
    var catena;
    var bullets;
    var olaf;
    var elsa;
    var elsa_flag = 0;
    var limite_sx_elsa = 19800;
    var limite_dx_elsa = 20800;
    var elsa_si_muove = "verso SX";
    var olaf_collisione = 0;
    var olaf_colpito_flag = 0;
    var tasto_salta;
    var parametro;
    var timer_olaf_colpito;
    var fiocchi;
    var fiocchi_livello3;
    var ghiaccio;
    var cursors;
    var bullet;
    var bullet_counter = 0;
    var tempo_totale_timer = 28;
    var tempo_rimasto;
    var olaf_reset = 0;
    var weapon;
    var weapon2;
    var fireButton;
    var testButton;
    var vittoriaButton;
    var sconfittaButton;
    var cubettoButton;
    var ghiaccioButton;
    var livello2Button;
    var livello3Button;
    var cubetto_corrente = 0;
    var direzione_olaf = "verso_dx";
    var vita;
    var vita_olaf = 5;
    var vita_elsa = 5;
    var colpi_subiti_nemico = 0;
    var colpi_subiti_elsa = 0;
    var tempo_scioglimento_barra = 0.65;
    var bandierina1_alzata = 0;
    var bandierina2_alzata = 0;
    var bandierina3_alzata = 0;
    const nemico = [0,1,2,3,4,5];
    const timer = [0,1,2,3,4,5];
    const timer_stop_nemico = [0,1,2,3,4,5,6];
    const nemico_ascisse = [2925,6345,8817,10140,15384,16224];
    const nemico_ordinate = [520,520,520,520,520,520];
    const limite_dx_nemico = [2926,6346,8818,10139,15383,16223,19500]; //19574
    const limite_sx_nemico = [2110,5770,8007,9750,14993,15549,18740];
    const nemico_si_muove = ["verso SX","verso SX","verso SX","verso SX","verso SX","verso SX","verso SX"];
    const munizioni_ascisse = [24, 78, 132, 186, 240, 294];
    const munizioni_ordinate = [50, 50, 50, 50, 50, 50];
    const fiocco = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18];
    const fiocco_l3 = [0,1,2,3,4,5,6,7];
    const fiocco_ascisse = [516, 1060, 1536, 2043, 4078, 4968, 6150, 6699, 7579, 9288, 9288, 10650, 12566, 13565, 15420, 16000, 17223, 18184, 19042];
    const fiocco_ordinate = [590, 480, 415, 590, 590, 605, 590, 468, 190, 306, 560, 590, 590, 295, 590, 590, 290, 370, 590];
    //const piattaforma_fissa_ascisse = [0, 1851, 3518, 5620, 7857, 9668, 10229, 11979, 14780, 18602, 4866, 5258, 961, 6591, 3146, 4448, 8664, 9184, 11063, 13023, 14414, 17579];
    const piattaforma_fissa_ascisse = [18090, 16672, 13958, 0, 1851, 3518, 5620, 7480, 7857, 9668, 10229, 11979, 14780, 18602, 19995, 5124, 4766, 5258, 961, 6591, 3146, 4448, 8864, 9184, 11063, 13023, 14414, 17579, 19980, 20310];
    const piattaforma_fissa_ordinate = [427, 464, 340, 670, 670, 670, 670, 245, 670, 670, 670, 670, 670, 670, 670, 260, 400, 513, 544, 528, 461, 513, 457, 357, 514, 518, 518, 492, 497, 354];
    const fiocco_l3_ascisse = [0,1,2,3,4,5,6,7];
    const fiocco_l3_ordinate = [0,1,2,3,4,5,6,7];
//  Irene 18-1-22 const piattaforma_fissa_ascisse = [0, 1851, 3518, 5620, 7857, 9668, 10229, 11979, 14780, 18602, 4766, 5258, 961, 6591, 3146, 4448, 8864, 9184, 11063, 13023, 14414, 17579, 5124, 19930, 20392];
//  Irene 18-1-22 const piattaforma_fissa_ordinate = [670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 400, 513, 544, 528, 461, 513, 457, 357, 514, 518, 518, 492, 270, 254];

    //const piattaforma_fissa_ordinate = [660, 660, 660, 660, 660, 660, 660, 660, 660, 660, 321, 513, 544, 528, 397, 513, 397, 397, 394, 518, 518, 492]; Vecchia del 15/1/2022
    //const piattaforma_fissa_ordinate = [660, 660, 660, 660, 660, 660, 660, 660, 660, 660, 321, 513, 544, 528, 397, 513, 397, 397, 384, 518, 518, 492]; Vecchia 1
    const tipo_piattaforma_fissa = ["sospesa2_f", "sospesa2_f", "sospesa2_f", "ground1", "ground2", "ground3", "ground4", "sospesa_f", "ground5", "ground6", "ground7", "ground8", "ground9", "ground10", "ground11", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa_f", "sospesa2_f", "sospesa2_f", "sospesa2_f", "sospesa2_f", "sospesa3_f", "sospesa3_f"];
    const piattaforma_mobile_ascisse = [1438, 4866, 7030, 11486, 13453,  17123];
    const piattaforma_mobile_ordinate = [481, 662, 367, 580, 360, 340];
    const tipo_piattaforma_mobile = ["sospesa_m", "sospesa_m", "sospesa_m", "sospesa2_m", "sospesa2_m", "sospesa2_m", "sospesa2_m"];
    const piattaforma_fissa = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28];
    const piattaforma_mobile = [0,1,2,3,4,5];
    const munizione = [0,1,2,3];

    function create() {

        game.physics.startSystem(Phaser.Physics.ARCADE);
        game.world.setBounds(0, 0, 20935, 768);
        this.game.scale.pageAlignHorizontally = true;this.game.scale.pageAlignVertically = true;this.game.scale.refresh();

        //Elementi musicali
        blink = game.add.audio('blink', .08);
        cubetto = game.add.audio('cubetto', 0.8, false);
        palla = game.add.audio('palla', .2, false);
        ciff = game.add.audio('ciff', .8, true);
        olafspuntonato = game.add.audio('olafspuntonato', .8, false);
        secco = game.add.audio('secco', .8, true);
        cadutaterre = game.add.audio('cadutaterre', 1, false);
        musicacheckpoint = game.add.audio('musicacheckpoint', 0.15, false);
        suononeve = game.add.audio('suononeve', 0.4, false);
        muromattoni = game.add.audio('muromattoni', 1);

        //Musica di sottofondo livello 1
        ambience1 = game.add.audio('fruscio', 0.6).loopFull();
        ambience1.play();

        //Musica di sottofondo livello 2
        ambience2 = game.add.audio('castle', 0.4).loopFull();
        ambience2.play();

        //Musica di sottofondo livello 3
        ambience3 = game.add.audio('sfida', 0.4).loopFull();
        ambience3.play();

        //Suono acqua
        suonolago = game.add.audio('suonolago', 0.2).loopFull();
        suonolago.play();

        //Sfondi primo livello
        livello_1a = game.add.tileSprite(0, -20, 10240, 930, 'livello1_a');
        //livello_1_davanti.fixedToCamera = false;

        nebbia = game.add.tileSprite(0, -20, 10240, 930, 'nebbia');
        nebbia.alpha = 0.5;
        //livello_1_davanti.fixedToCamera = false;

        livello_1b = game.add.tileSprite(0, 0, 10240, 768, 'livello1_b');
        //livello_1_davanti.fixedToCamera = false;

        livello_1c = game.add.tileSprite(0, 20, 10240, 768, 'livello1_c');
        //livello_1_davanti.fixedToCamera = false;

        livello_1d = game.add.tileSprite(0, 0, 10240, 768, 'livello1_d');
        //livello_1_davanti.fixedToCamera = false;

        //Sfondi secondo e terzo livello
        livello_2a = game.add.tileSprite(10187, 30, 10397, 768, 'livello2_a');
        //livello_2_davanti.fixedToCamera = false;

        livello_2b = game.add.tileSprite(10087, 30, 10397, 768, 'livello2_b');
        //livello_2_davanti.fixedToCamera = false;

        livello_3a = game.add.tileSprite(19922, 0, 1024, 768, 'livello3_a');
        //livello_3.fixedToCamera = false;

        livello_3b1 = game.add.tileSprite(19922, 0, 1024, 768, 'livello3_b1');
        livello_3b1.alpha = 0.4;
        //livello_3.fixedToCamera = false;

        livello_3b = game.add.tileSprite(19922, 0, 1024, 768, 'livello3_b');
        //livello_3.fixedToCamera = false;


        // Lampadari stalattiti

        stalattiti = game.add.group();
        stalattiti.enableBody = true;

        for (var i = 0; i < 2; i++){

            lampadario_cadente[i] = stalattiti.create(lampadario_cadente_ascisse[i], lampadario_cadente_ordinate[i], 'lampadario_cadente');  //12570
            lampadario_cadente[i].animations.add('fisso', [0]);
            lampadario_cadente[i].play('fisso',20,true);}

        stalattiti.setAll('body.immovable', true);
        stalattiti.setAll('anchor.x', .5);

        //Animazione lampadario normale
        lampadario1 = game.add.sprite(10448, 100, 'lampadario');
        lampadario1.animations.add('lampadario_oscilla1', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario2 = game.add.sprite(11458, 100, 'lampadario');
        lampadario2.animations.add('lampadario_oscilla2', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario3 = game.add.sprite(13488, 100, 'lampadario');
        lampadario3.animations.add('lampadario_oscilla3', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario4 = game.add.sprite(15514, 100, 'lampadario');
        lampadario4.animations.add('lampadario_oscilla4', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario5 = game.add.sprite(16534, 100, 'lampadario');
        lampadario5.animations.add('lampadario_oscilla5', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario6 = game.add.sprite(17544, 100, 'lampadario');
        lampadario6.animations.add('lampadario_oscilla6', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);

        lampadario7 = game.add.sprite(18562, 100, 'lampadario');
        lampadario7.animations.add('lampadario_oscilla7', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36]);



        livello_2c = game.add.tileSprite(9527, -2, 10819, 768, 'livello2_c');
        //livello_2_davanti.fixedToCamera = false;

        acqua = game.add.sprite(8800, 680, 'acqua_onde');
        acqua.animations.add('acqua_fossato', [0,1,2,3], 4, true);
        acqua.scale.setTo(0.9);
        acqua.alpha = 0.8;


        ponte = game.add.tileSprite(9243, 624, 421, 22, 'ponte_levatoio');
        ponte.fixedToCamera = false;
        game.physics.arcade.enable(ponte);
        ponte.body.immovable = true;

        catena = game.add.tileSprite(9309, 258, 528, 510, 'catena');
        catena.fixedToCamera = false;

        //Piattaforme fisse come sfondo
        piattfo1 = game.add.sprite(0, 660, 'piattfo1');
        piattfo2 = game.add.sprite(1851, 660, 'piattfo2');
        piattfo3 = game.add.sprite(3518, 660, 'piattfo3');
        piattfo4 = game.add.sprite(5620, 660, 'piattfo4');
        piattfo5 = game.add.sprite(7857, 660, 'piattfo5');

        piattfo6 = game.add.sprite(9650, 660, 'piattfo6');
        piattfo7 = game.add.sprite(10229, 660, 'piattfo7');
        piattfo8 = game.add.sprite(11979, 660, 'piattfo8');
        piattfo9 = game.add.sprite(14780, 660, 'piattfo9');
        piattfo10 = game.add.sprite(18602, 660, 'piattfo10');
        piattfo11 = game.add.sprite(19945, 660, 'piattfo11');


        // Creo il primo check-point (bandierina1)
        bandierina1 = game.add.sprite(130, 465, 'check-point');
        bandierina1.scale.setTo(0.9);

        bandierina1.animations.add('bandiera_sale', [0,1,2,3,4,5,6,7,8,9,10]);
        bandierina1.animations.add('bandiera_scende', [10,9,8,7,6,5,4,3,2,1,0]);
        bandierina1.animations.add('bandiera_sventola', [11,12,13,14,15,16,17,18,19], true);
        bandierina1.animations.add('bandiera_ferma', [0],false)

        // Creo il secondo check-point (bandierina2)
        bandierina2 = game.add.sprite(10420, 465, 'check-point');
        bandierina2.scale.setTo(0.9);

        bandierina2.animations.add('bandiera_sale', [0,1,2,3,4,5,6,7,8,9,10]);
        bandierina2.animations.add('bandiera_scende', [10,9,8,7,6,5,4,3,2,1,0]);
        bandierina2.animations.add('bandiera_sventola', [11,12,13,14,15,16,17,18,19], true);
        bandierina2.animations.add('bandiera_ferma', [0],false)

        // Creo il terzo check-point (bandierina3)
        bandierina3 = game.add.sprite(19779, 465, 'check-point');
        bandierina3.scale.setTo(0.9);

        bandierina3.animations.add('bandiera_sale', [0,1,2,3,4,5,6,7,8,9,10]);
        bandierina3.animations.add('bandiera_scende', [10,9,8,7,6,5,4,3,2,1,0]);
        bandierina3.animations.add('bandiera_sventola', [11,12,13,14,15,16,17,18,19], true);
        bandierina3.animations.add('bandiera_ferma', [0],false)


        //Informazioni tutorial
        tastoinfo1 = game.add.sprite(100, 300, 'tastoinfo1');
        tastoinfo1.scale.setTo(0.7);
        tastoinfo1.animations.add('tastoinfo1_schiaccia', [0,1]);
        tastoinfo1.enableBody = true;
        tastoinfo1.alpha = 0;

        tastoinfo2 = game.add.sprite(650, 300, 'tastoinfo2');
        tastoinfo2.scale.setTo(0.6);
        tastoinfo2.animations.add('tastoinfo2_schiaccia', [0,1]);
        tastoinfo2.enableBody = true;
        tastoinfo2.alpha = 0;

        tastoinfo3 = game.add.sprite(1900, 300, 'tastoinfo3');
        tastoinfo3.scale.setTo(0.8);
        tastoinfo3.animations.add('tastoinfo3_schiaccia', [0,1]);
        tastoinfo3.enableBody = true;
        tastoinfo3.alpha = 0;

        tastoinfo4 = game.add.sprite(2860, 300, 'tastoinfo4');
        tastoinfo4.scale.setTo(0.8);
        tastoinfo4.animations.add('tastoinfo4_schiaccia', [0,1]);
        tastoinfo4.enableBody = true;
        tastoinfo4.alpha = 0;

        trono_sotto = game.add.tileSprite(20725, 612, 199, 60, 'trono_sotto');
        game.physics.arcade.enable(trono_sotto);
        trono_sotto.body.immovable = true;
        trono_sotto.fixedToCamera = false;

        trono_sopra= game.add.tileSprite(20828, 325, 105, 290, 'trono_sopra');
        game.physics.arcade.enable(trono_sopra);
        trono_sopra.body.immovable = true;
        trono_sopra.fixedToCamera = false;

        muro = game.add.sprite(19550, 340, 'muro'); //19450
        game.physics.arcade.enable(muro);
        muro.body.collideWorldBounds = true;
        muro.body.immovable = true;
        muro.fixedToCamera = false;
        muro.body.enable = false;

        bottone_uscita_gioco = game.add.button(900, 21, 'bottone_uscita_gioco', link_per_exit, this, 0);
        bottone_uscita_gioco.scale.setTo(0.204);
        bottone_uscita_gioco.fixedToCamera = true;


        // Creo il gruppo dei Mattoni che visualizzerò solo quando Olaf arriva al livello 3

        mattoni = game.add.group();
        mattoni.enableBody = true;
        game.physics.arcade.enable(mattoni);

        // Creo l'icona della vita Olaf (di fianco alla barra della vita)

        icona_vita_olaf = game.add.sprite(292, 22, 'icona_olaf');
        icona_vita_olaf.scale.setTo(0.66);
        icona_vita_olaf.fixedToCamera = true;

        // Creo l'icona del numero delle vite rimaste a Olaf

        numero_vita_olaf_5 = game.add.sprite(324, 47, 'numero_vita_5');
        numero_vita_olaf_5.scale.setTo(0.24);
        numero_vita_olaf_5.alpha = 0.98;
        numero_vita_olaf_5.fixedToCamera = true;

        numero_vita_olaf_4 = game.add.sprite(324, 47, 'numero_vita_4');
        numero_vita_olaf_4.scale.setTo(0.24);
        numero_vita_olaf_4.alpha = 0;
        numero_vita_olaf_4.fixedToCamera = true;

        numero_vita_olaf_3 = game.add.sprite(324, 47, 'numero_vita_3');
        numero_vita_olaf_3.scale.setTo(0.24);
        numero_vita_olaf_3.alpha = 0;
        numero_vita_olaf_3.fixedToCamera = true;

        numero_vita_olaf_2 = game.add.sprite(324, 47, 'numero_vita_2');
        numero_vita_olaf_2.scale.setTo(0.24);
        numero_vita_olaf_2.alpha = 0;
        numero_vita_olaf_2.fixedToCamera = true;

        numero_vita_olaf_1 = game.add.sprite(324, 47, 'numero_vita_1');
        numero_vita_olaf_1.scale.setTo(0.24);
        numero_vita_olaf_1.alpha = 0;
        numero_vita_olaf_1.fixedToCamera = true;

        numero_vita_olaf_0 = game.add.sprite(324, 47, 'numero_vita_0');
        numero_vita_olaf_0.scale.setTo(0.24);
        numero_vita_olaf_0.alpha = 0;
        numero_vita_olaf_0.fixedToCamera = true;

        // Creo l'icona della vita di Elsa che viene visualizzata solo quando Olaf arriva al livello 3 (di fianco all'icona di Olaf)

        icona_vita_elsa = game.add.sprite(820, 26, 'icona_elsa');
        icona_vita_elsa.scale.setTo(0.67);
        icona_vita_elsa.alpha = 0;
        icona_vita_elsa.fixedToCamera = true;

        // Creo l'icona del numero delle vite rimaste a Elsa

        numero_vita_elsa_5 = game.add.sprite(852, 47, 'numero_vita_5');
        numero_vita_elsa_5.scale.setTo(0.24);
        numero_vita_elsa_5.alpha = 0;
        numero_vita_elsa_5.fixedToCamera = true;

        numero_vita_elsa_4 = game.add.sprite(852, 47, 'numero_vita_4');
        numero_vita_elsa_4.scale.setTo(0.24);
        numero_vita_elsa_4.alpha = 0;
        numero_vita_elsa_4.fixedToCamera = true;

        numero_vita_elsa_3 = game.add.sprite(852, 47, 'numero_vita_3');
        numero_vita_elsa_3.scale.setTo(0.24);
        numero_vita_elsa_3.alpha = 0;
        numero_vita_elsa_3.fixedToCamera = true;

        numero_vita_elsa_2 = game.add.sprite(852, 47, 'numero_vita_2');
        numero_vita_elsa_2.scale.setTo(0.24);
        numero_vita_elsa_2.alpha = 0;
        numero_vita_elsa_2.fixedToCamera = true;

        numero_vita_elsa_1 = game.add.sprite(852, 47, 'numero_vita_1');
        numero_vita_elsa_1.scale.setTo(0.24);
        numero_vita_elsa_1.alpha = 0;
        numero_vita_elsa_1.fixedToCamera = true;

        numero_vita_elsa_0 = game.add.sprite(852, 47, 'numero_vita_0');
        numero_vita_elsa_0.scale.setTo(0.24);
        numero_vita_elsa_0.alpha = 0;
        numero_vita_elsa_0.fixedToCamera = true;

        // Funzione per l'uscita dal gioco  richiesta tramite il bottone di uscita (richiamo la url definita nella variabile 'url_exit')
        function link_per_exit()
        {
            // Ritorno alla Homepage (vedi variabile 'url_exit')
            var s = window.open(url_exit, '_self');
        }

        // Rovi
        rovi = game.add.group();
        rovi.enableBody = true;

        rovi.create(3600, 618, 'rovi').body.setSize(80, 40, 10, 10);
        rovi.create(3960, 618, 'rovi').body.setSize(80, 40, 10, 10);
        rovi.create(5388, 464, 'rovi').body.setSize(80, 40, 10, 10);
        rovi.create(7900, 618, 'rovi').body.setSize(80, 40, 10, 10);
        rovi.setAll('body.immovable', true);

        // Spuntoni
        spuntoni = game.add.group();
        spuntoni.enableBody = true;

        spuntoni.create(12146, 586, 'spuntoni').body.setSize(124, 121, 20, 10);
        spuntoni.create(14800, 586, 'spuntoni').body.setSize(124, 121, 10, 10);
        spuntoni.create(18814, 586, 'spuntoni').body.setSize(124, 121, 10, 10);
        spuntoni.create(19118, 586, 'spuntoni').body.setSize(124, 121, 10, 10);
        spuntoni.create(19438, 586, 'spuntoni').body.setSize(124, 121, 10, 10);
        spuntoni.setAll('body.immovable', true);

        // Creazione della corona (fine livello 3)
        corona = game.add.sprite(20597, 1000, 'corona');
        corona.scale.setTo(0.8);
        game.physics.arcade.enable(corona);
        corona.body.setSize(100, 160, 0, 0);

        //Animazione torcia
        torcia1 = game.add.sprite(11750, 384, 'torcia');
        torcia1.scale.setTo(0.8);
        torcia1.animations.add('torcia_animata1', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]);

        torcia2 = game.add.sprite(13781, 384, 'torcia');
        torcia2.scale.setTo(0.8);
        torcia2.animations.add('torcia_animata2', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]);

        torcia3 = game.add.sprite(15807, 384, 'torcia');
        torcia3.scale.setTo(0.8);
        torcia3.animations.add('torcia_animata3', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]);

        torcia4 = game.add.sprite(17837, 384, 'torcia');
        torcia4.scale.setTo(0.8);
        torcia4.animations.add('torcia_animata4', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]);

        torcia5 = game.add.sprite(19867, 384, 'torcia');
        torcia5.scale.setTo(0.8);
        torcia5.animations.add('torcia_animata5', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]);



        // Creazione del gruppo piattaforme_fisse

        piattaforme_fisse = game.add.group();

        // Abilita physics per tutti le piattaforme_fisse che verranno create nel gruppo
        piattaforme_fisse.enableBody = true;

        for (var i = 0; i < 30; i++)
        {
            //  Creo le piattaforme nel gruppo (in posizione pre-determinata dalle costanti piattaforma_ascisse e piattaforma_ordinate)

                piattaforma_fissa[i] = piattaforme_fisse.create(piattaforma_fissa_ascisse[i], piattaforma_fissa_ordinate[i], tipo_piattaforma_fissa[i]);
                game.physics.arcade.enable(piattaforma_fissa[i]);
                piattaforma_fissa[i].body.immovable = true;
        }

        // Creazione delle piattaforme mobili

        for (var i = 0; i < 6; i++){

                piattaforma_mobile[i] = game.add.sprite(piattaforma_mobile_ascisse[i], piattaforma_mobile_ordinate[i], tipo_piattaforma_mobile[i], 0);
                piattaforma_mobile[i].animations.add('piattaforma_si_rompe', [0,1,2,3,4,5,6,7,8,9,10,11,12], 4, true);
                piattaforma_mobile[i].animations.add('piattaforma_ferma', [0], 4, true);
                game.physics.arcade.enable(piattaforma_mobile[i]);
                piattaforma_mobile[i].body.immovable = true;

        }

        // Creazione di Olaf

        olaf = game.add.sprite(20, 400, 'olaf', 13);
        game.physics.arcade.enable(olaf);

        //olaf.body.bounce.y = 0.2;
        olaf.body.gravity.y = 440;
        olaf.body.collideWorldBounds = true;
        olaf.body.setSize(62, 100, 2, 20);

        game.camera.follow(olaf);

        // Animazioni di Olaf

        olaf.animations.add('olaf_cammina_sx', [14,15,16,17,18,19,20,21,22,23,24,25], 26, true);
        olaf.animations.add('olaf_cammina_dx', [0,1,2,3,4,5,6,7,8,9,10,11,12], 26, true);
        olaf.animations.add('olaf_guarda_avanti', [13], 10, true);
        olaf.animations.add('olaf_sparasx', [46,47], 10, true);
        olaf.animations.add('olaf_sparadx', [45,46], 12, true);
        olaf.animations.add('olaf_cammina_su_sx', [26,27,28,29,30,31,32,33,34], 5, false);
        olaf.animations.add('olaf_cammina_su_dx', [35,36,37,38,39,40,41,42,43], 5, false);
        olaf.animations.add('olaf_cammina_su_centro', [57,58,59,60,61,63], 5, false);
        //olaf.animations.add('olaf_cammina_su_sx', [26,27,28,29,30,31,32,33,34], 5, false);  //Codice Nuovo di Daniele che richiede immagine Olafincompleto
        //olaf.animations.add('olaf_cammina_su_dx', [35,36,37,38,39,40,41,42,43], 5, false);

        // Creazione di Elsa (nella versione attuale non viene utilizzata l'animazione)
        elsa = game.add.sprite(20750, 500, 'elsa', 3); // era frame 20
        //elsa.scale.setTo(0.2);
        game.physics.arcade.enable(elsa);

        //elsa.body.gravity.y = 440;
        elsa.body.collideWorldBounds = true;
        //elsa.body.setSize(290, 504, 11, 100);

        // Animazioni di Elsa (disponibili ma non usate in questa versione)

        elsa.animations.add('elsa_cammina_sx', [15,16,17,18,19,20,21,22,23,24,25,26,27,28], 26, true);
        elsa.animations.add('elsa_cammina_dx', [0,1,2,3,4,5,6,7,8,9,10,11,13], 26, true);
        elsa.animations.add('elsa_inchino_sx', [25,26,27,28,29,30,31],5, false);
        elsa.animations.add('elsa_guarda_avanti', [14], 10, true);
        //elsa.body.velocity.x = -75;
        elsa.body.immovable = true;

        // Definisco i tasti funzione
        cursors = game.input.keyboard.createCursorKeys();
        tasto_salta = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
        fireButton = game.input.keyboard.addKey(Phaser.Keyboard.S);
        testButton = game.input.keyboard.addKey(Phaser.Keyboard.T);
        ghiaccioButton = game.input.keyboard.addKey(Phaser.Keyboard.G);
        cubettoButton = game.input.keyboard.addKey(Phaser.Keyboard.D);
        vittoriaButton = game.input.keyboard.addKey(Phaser.Keyboard.ZERO);
        sconfittaButton = game.input.keyboard.addKey(Phaser.Keyboard.NINE);
        livello2Button = game.input.keyboard.addKey(Phaser.Keyboard.TWO);
        livello3Button = game.input.keyboard.addKey(Phaser.Keyboard.THREE);

        for (var i = 0; i < 6; i++)
        {
            //  Creo il nemico (in posizione pre-determinata dalle costanti nemico_ascisse e nemico_ordinate)


                nemico[i] = game.add.sprite(nemico_ascisse[i], nemico_ordinate[i], 'nemico');
                nemico[i].animations.add('nemico_cammina_verso_sx', [19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36], true);
                nemico[i].animations.add('nemico_cammina_verso_dx', [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17], true);
                nemico[i].animations.play('nemico_cammina_verso_sx', 18, true);
                game.physics.arcade.enable(nemico[i]);
                nemico[i].body.collideWorldBounds = true;
                nemico[i].body.onWorldBounds = new Phaser.Signal();
                nemico[i].body.onWorldBounds.add(colpisco_world_boundaries, this);
                // Imposto una hitbox di dimensoni differenti a quelle dello spritesheet
                //nemico[i].body.setSize(80, 120, 5, 30);


        }
        for (var i = 0; i < 6; i++)
        {
        nemico[i].body.velocity.x = -75;}

        //  Creo il timer per fermare il nemico la prima volta che viene colpito (4 secondi)
        //  se il nemico viene colpito una seconda volta mentre è fermo il nemico muore (vedi funzione nemico_colpito)
        //  allo scadere del timer viene richiamata la funzione 'risveglia_nemico'

        for (var i = 0; i < 6; i++) {
            timer_stop_nemico[i] = game.time.create(false);
            timer_stop_nemico[i].loop(3000, risveglia_nemico, this, i);
        }

        // Creo la barra del tempo (vita di Olaf)
        vita = game.add.sprite(22, 20, 'vita');
        vita.scale.setTo(1.1);
        vita.fixedToCamera = true;

        vita.animations.add('barra');
        vita.animations.play('barra', tempo_scioglimento_barra, false);

        text = game.add.text(425, 350, "       ", {fill:"white"});

        //Creo il segna-munizioni (5 fiocchi)

        for (var i = 0; i < 5; i++)
        {

            munizione[i] = game.add.sprite(munizioni_ascisse[i], munizioni_ordinate[i], 'bullets');
            munizione[i].scale.setTo(0.6);
            munizione[i].alpha = 0.5;
            munizione[i].fixedToCamera = true;
        }

        // Creazione i fiocchi da catturare (19 fiocchi diventano munizioni quando catturati) questi sono i fiocchi del livello 1 e 2.

        fiocchi = game.add.group();

        // Abilita physics per tutti i fiocchi che verranno creati nel gruppo dei fiocchi di livello 1 e 2
        fiocchi.enableBody = true;

        //  Loop per la creazione dei fiocchi
        for (var i = 0; i < 19; i++)
        {
            //  Creo i fiocchi nel gruppo (in posizione pre-determinata dalle costanti fiocco_ascisse e fiocco_ordinate)

            fiocco[i] = fiocchi.create(fiocco_ascisse[i], fiocco_ordinate[i], 'fiocco');
            fiocco[i].scale.setTo(0.2);
            fiocco[i].animations.add('brilla', [0, 1, 2, 3, 4, 5, 6, 7, 8 ,9 , 8, 7, 6, 5, 4, 3, 2, 1]);
            fiocco[i].animations.play('brilla',20, true);

        }


        // Creazione i fiocchi per il livello 3 da catturare (8 fiocchi diventano munizioni quando catturati)
        // il primo fiocco è a posizione fissa i rimanenti 7 fiocchi sono creati in posizione randomica

        fiocchi_livello3 = game.add.group();

        // Abilita physics per tutti i fiocchi che verranno creati nel gruppo
        fiocchi_livello3.enableBody = true;

        //  creazione del primo fiocco a posizione fissa
        fiocco_l3_ascisse[0] = 19800;
        fiocco_l3_ordinate[0] = 520;
        fiocco_l3[0] = fiocchi_livello3.create(fiocco_l3_ascisse[0], fiocco_l3_ordinate[0], 'fiocco');
        //fiocco_l3[0] = fiocchi_livello3.create(19770, 490, 'fiocco');
        fiocco_l3[0].scale.setTo(0.2);
        fiocco_l3[0].animations.add('brilla', [0, 1, 2, 3, 4, 5, 6, 7, 8 ,9 , 8, 7, 6, 5, 4, 3, 2, 1]);
        fiocco_l3[0].animations.play('brilla',20, true);

        //  Loop per la creazione dei rimanenti 7 fiocchi in posizione randomica
        for (var i = 1; i < 8; i++)
        {
            fiocco_l3_ascisse[i] = (Math.floor(Math.random() *776) + 19856);
            fiocco_l3_ordinate[i] = (Math.floor(Math.random() *500) + 50);
            fiocco_l3[i] = fiocchi_livello3.create(fiocco_l3_ascisse[i], fiocco_l3_ordinate[i], 'fiocco');
            fiocco_l3[i].scale.setTo(0.2);
            fiocco_l3[i].animations.add('brilla', [0, 1, 2, 3, 4, 5, 6, 7, 8 ,9 , 8, 7, 6, 5, 4, 3, 2, 1]);
            fiocco_l3[i].animations.play('brilla',20, true);
        }


        //ciapi
        //ciapi = game.add.group();

        // Abilita physics per tutti i fiocchi che verranno creati nel gruppo
        //ciapi.enableBody = true;

        //  Loop per la creazione dei fiocchi
        //for (var i = 0; i < 18; i++)
        //{
            //  Creo i fiocchi nel gruppo (in posizione pre-determinata dalle costanti fiocco_ascisse e fiocco_ordinate)

            //ciapa[i] = ciapi.create(ciapa_ascisse[i], ciapa_ordinate[i], 'ciapa');
            //ciapa[i].scale.setTo(0.2);
            //ciapa[i].animations.add('ciapata', [18,19,20,21, false, true]);

        //}




        // Creo le munizioni (i weapons - le palle di neve)

        weapon = game.add.weapon(5, 'neve');
        weapon.trackSprite(olaf,50,50,false);
        weapon.fireAngle = 0;
        weapon.bulletAngleVariance = 5;
        weapon.bulletSpeed = 800;
        weapon.fireLimit = 5;
        weapon.fireRate = 240;
        game.physics.arcade.enable(weapon);
        weapon.bulletCollideWorldBounds = false;

        // Creo le munizioni di elsa

        weapon2 = game.add.weapon(1000, 'proiettile_elsa');
        weapon2.trackSprite(elsa,0,80,false);
        weapon2.setBulletBodyOffset(0.1, 0.1, 0, 0);
        weapon2.fireAngle = 15;
        weapon2.bulletAngleVariance = 60;
        weapon2.bulletSpeed = -300;
        weapon2.fireLimit = 100;
        weapon2.fireRate = 800;
        game.physics.arcade.enable(weapon2);
        weapon2.bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;


        // Creo i blocchetti di ghiaccio

        ghiaccio = game.add.weapon(5, 'cubetto_ghiaccio');
        ghiaccio.trackSprite(olaf,50,50,false);
        ghiaccio.fireAngle = 0;
        ghiaccio.bulletGravity.y = 90;
        ghiaccio.bulletAngleVariance = 0;
        //ghiaccio.bulletSpeed = 100;
        ghiaccio.bulletSpeed = 100 ;
        ghiaccio.fireLimit = 100;
        ghiaccio.fireRate = 240;
        game.physics.arcade.enable(ghiaccio.bullets);
        ghiaccio.bulletCollideWorldBounds = false;

        // Preparo le variabili per il Timer della vita di Olaf

        tempo_rimasto = tempo_totale_timer;
        tempo();


    }
    function update() {





                      if (olaf.x > 0 && olaf.x < 9745)
                      {
                          ambience1.mute = false;
                      }
                      else
                      {
                          ambience1.mute = true;
                      }


                      if (olaf.x > 9554 && olaf.x < 20000)
                      {
                          ambience2.mute = false;
                      }
                      else
                      {
                          ambience2.mute = true;
                      }


                      if (olaf.x > 8845 && olaf.x < 9145)
                      {
                        ambience1.volume = 0.5;
                      }
                      if (olaf.x > 9145 && olaf.x < 9245)
                      {
                        ambience1.volume = 0.4;
                      }
                      if (olaf.x > 9245 && olaf.x < 9445)
                      {
                        ambience1.volume = 0.3;
                      }
                      if (olaf.x > 9445 && olaf.x < 9745)
                      {
                        ambience1.volume = 0.2;
                      }

                      if (olaf.x > 9554 && olaf.x < 9545)
                      {
                        ambience1.volume = 0.08;
                        ambience2.volume = 0.04;
                      }
                      if (olaf.x > 9545 && olaf.x < 9645){
                        ambience2.volume = 0.06;
                      }
                      if (olaf.x > 9945 && olaf.x < 12455){
                        ambience2.volume = 0.1;
                      }
                      if (olaf.x > 12455 && olaf.x < 13655){
                        ambience2.volume = 0.16;
                      }
                      if (olaf.x > 13655 && olaf.x < 19800){
                        ambience2.volume = 0.2;
                      }

                      if (olaf.x > 19800 && olaf.x < 19900)
                      {
                        ambience2.volume = 0.2;
                      }


                      if (olaf.x > 19700)
                      {
                          ambience3.mute = false;
                          ambience3.volume = 0.4;
                          ambience2.volume = 0.08;
                      }
                      else
                      {
                          ambience3.mute = true;
                      }

                      if (olaf.x > 19900 && olaf.x < 20000)
                      {
                        ambience3.volume = 0.3;
                        ambience2.volume = 0.02;

                      }


        //Suono acqua
        if (olaf.x > 8000 && olaf.x < 10000)
        {
            suonolago.mute = false;
          }
        else{
            suonolago.mute = true;
          }
          if (olaf.x > 10000 && olaf.x < 10000)
          {
              suonolago.volume = 0.1;
            }
          else{
              suonolago.volume = 0.2;
            }
            if (olaf.x > 8000 && olaf.x < 9000)
            {
                suonolago.volume = 0.1;
              }
            else{
                suonolago.volume = 0.2;
              }


        // Informazioni Tutorial

        if (olaf.x > 0 && olaf.x < 220 && olaf.y > 500) { tastoinfo1.alpha = 1; tastoinfo1.x = olaf.x - 40; tastoinfo1.y = olaf.y - 200}
        else { tastoinfo1.alpha = 0; };

        if (olaf.x > 550 && olaf.x < 750) { tastoinfo2.alpha = 1; tastoinfo2.x = olaf.x - 74; tastoinfo2.y = olaf.y - 195}
        else { tastoinfo2.alpha = 0; };

        if (olaf.x > 1800 && olaf.x < 2200 && olaf.y > 300) { tastoinfo3.alpha = 1; tastoinfo3.x = olaf.x - 15; tastoinfo3.y = olaf.y - 200}
        else { tastoinfo3.alpha = 0; };

        if (olaf.x > 2760 && olaf.x < 2960) { tastoinfo4.alpha = 1; tastoinfo4.x = olaf.x - 10; tastoinfo4.y = olaf.y - 200}
        else { tastoinfo4.alpha = 0; };

        tastoinfo1.animations.play('tastoinfo1_schiaccia', 2, true,);
        tastoinfo2.animations.play('tastoinfo2_schiaccia', 2, true,);
        tastoinfo3.animations.play('tastoinfo3_schiaccia', 2, true,);
        tastoinfo4.animations.play('tastoinfo4_schiaccia', 2, true,);

        //Parallasse Orizzontale e Verticale dellle immagini di sfondo
        livello_1a.tilePosition.x = olaf.x * -0.06;
        livello_1b.tilePosition.x = olaf.x * -0.1;
        livello_1c.tilePosition.x = olaf.x * -0.04;
        livello_1d.tilePosition.x = olaf.x * -0.02;

        livello_1a.tilePosition.y = olaf.y * -0.03;
        livello_1b.tilePosition.y = olaf.y * -0.02;
        livello_1c.tilePosition.y = olaf.y * -0.01;
        livello_1d.tilePosition.y = olaf.y *  0.00;



        livello_2a.tilePosition.x = olaf.x * -0.06;
        livello_2b.tilePosition.x = olaf.x * -0.05;
        livello_2c.tilePosition.x = olaf.x * 0;

        livello_2a.tilePosition.y = olaf.y * -0.03;
        livello_2b.tilePosition.y = olaf.y * -0.02;
        livello_2c.tilePosition.y = olaf.y * 0;


        livello_3a.tilePosition.x = olaf.x * -0.02;
        livello_3b1.tilePosition.x = olaf.x * -0.03;
        livello_3b.tilePosition.x = olaf.x * -0.001;

        livello_3a.tilePosition.y = olaf.y * -0.02;
        livello_3b1.tilePosition.y = olaf.y * -0.01;
        livello_3b.tilePosition.y = olaf.y * -0.01;


      // Gestisco l'animazione del lampadario
      lampadario1.animations.play('lampadario_oscilla1', 8, true,);
      lampadario2.animations.play('lampadario_oscilla2', 8, true,);
      lampadario3.animations.play('lampadario_oscilla3', 8, true,);
      lampadario4.animations.play('lampadario_oscilla4', 8, true,);
      lampadario5.animations.play('lampadario_oscilla5', 8, true,);
      lampadario6.animations.play('lampadario_oscilla6', 8, true,);
      lampadario7.animations.play('lampadario_oscilla7', 8, true,);

      // Gestisco l'animazione della torcia
      torcia1.animations.play('torcia_animata1', 8, true,);
      torcia2.animations.play('torcia_animata2', 8, true,);
      torcia3.animations.play('torcia_animata3', 8, true,);
      torcia4.animations.play('torcia_animata4', 8, true,);
      torcia5.animations.play('torcia_animata5', 8, true,);


      // Gestisco l'animazione dell'acqua
      acqua.animations.play('acqua_fossato', 2, true,);






      // Stalattiti
      if (game.physics.arcade.overlap(olaf, stalattiti)) {olaf_dead()};
        stalattiti.children.forEach( function(lampadario_che_cade) {
            if (olaf.x > lampadario_che_cade.left-100 && olaf.x < lampadario_che_cade.right+100) {lampadario_che_cade.body.gravity.y = 900};
            if (lampadario_che_cade.top > game.world.height) {lampadario_che_cade.kill()};
      })
        // Gestisco il movimento di Elsa (non utilizzato in questa versione)
            /*
        if ( elsa.x > limite_dx_elsa )
        {
            elsa.x = limite_dx_elsa - 20;
            inverti_cammino("elsa",0);
        }
        if ( elsa.x < limite_sx_elsa )
        {
            elsa.x = limite_sx_elsa + 20;
            inverti_cammino("elsa",i);
        }
            */


        // Creo il muro di mattoni nel livello 3 quando Olaf passa la posizione di x 19800
        game.physics.arcade.collide(mattoni);
        mattoni.forEachExists(blocca_mattoni);

        if (olaf.x > 19800){
          muromattoni.play('', 0, .04, false, false);
        }

                if (olaf.x > 20000){
                  muromattoni.pause();
                }

        if (olaf.x > 19800 || muro_creato === 1) {



            muro_creato = 1;
            muro.body.enable = true;
            icona_vita_elsa.alpha = 1;
            if(vita_elsa === 5) {numero_vita_elsa_5.alpha = 0.95;}
            j++;
            if (j === intervallo_creazione_mattoni && numero_mattoni_creati < numero_mattoni_da_creare) {
                mattoni_cadenti(1);
                numero_mattoni_creati += 1
                mattoni.forEachExists(blocca_mattoni);
                j = 0;
            }
        }

        // Abilito Elsa a sparare quando Olaf passa oltre a x = 20000

        if (olaf.x < 20000) {weapon2.autofire = false;}
        if (vita_elsa != 0 && olaf.x > 20000) {weapon2.autofire = true;}
        if (vita_elsa === 0) {weapon2.autofire = false;}

        if (vita_olaf === 0) {numero_vita_olaf_0.alpha = 1; numero_vita_olaf_5.alpha = 0; numero_vita_olaf_4.alpha = 0; numero_vita_olaf_3.alpha = 0;numero_vita_olaf_2.alpha = 0;numero_vita_olaf_1.alpha =0;}
        else if (vita_olaf === 5) {numero_vita_olaf_5.alpha = 0.98; numero_vita_olaf_4.alpha = 0; numero_vita_olaf_3.alpha = 0;numero_vita_olaf_2.alpha = 0;numero_vita_olaf_1.alpha = 0;}
        else if (vita_olaf === 4) {numero_vita_olaf_4.alpha = 0.98; numero_vita_olaf_5.alpha = 0; numero_vita_olaf_3.alpha = 0;numero_vita_olaf_2.alpha = 0;numero_vita_olaf_1.alpha = 0;}
        else if (vita_olaf === 3) {numero_vita_olaf_3.alpha = 0.98; numero_vita_olaf_5.alpha = 0; numero_vita_olaf_4.alpha = 0;numero_vita_olaf_2.alpha = 0;numero_vita_olaf_1.alpha = 0;}
        else if (vita_olaf === 2) {numero_vita_olaf_2.alpha = 0.98; numero_vita_olaf_5.alpha = 0; numero_vita_olaf_4.alpha = 0;numero_vita_olaf_3.alpha = 0;numero_vita_olaf_1.alpha = 0;}
        else if (vita_olaf === 1) {numero_vita_olaf_1.alpha = 0.98; numero_vita_olaf_5.alpha = 0; numero_vita_olaf_4.alpha = 0;numero_vita_olaf_3.alpha = 0;numero_vita_olaf_2.alpha = 0;}

        if (vita_elsa === 0) {numero_vita_elsa_0.alpha = 1; numero_vita_elsa_5.alpha = 0; numero_vita_elsa_4.alpha = 0; numero_vita_elsa_3.alpha = 0;numero_vita_elsa_2.alpha = 0;numero_vita_elsa_1.alpha =0;}
        else if (vita_elsa === 5 && olaf.x > 19800) {numero_vita_elsa_5.alpha = 0.98; numero_vita_elsa_4.alpha = 0; numero_vita_elsa_3.alpha = 0;numero_vita_elsa_2.alpha = 0;numero_vita_elsa_1.alpha = 0;}
        else if (vita_elsa === 4 && olaf.x > 19800) {numero_vita_elsa_4.alpha = 0.98; numero_vita_elsa_5.alpha = 0; numero_vita_elsa_3.alpha = 0;numero_vita_elsa_2.alpha = 0;numero_vita_elsa_1.alpha = 0;}
        else if (vita_elsa === 3 && olaf.x > 19800) {numero_vita_elsa_3.alpha = 0.98; numero_vita_elsa_5.alpha = 0; numero_vita_elsa_4.alpha = 0;numero_vita_elsa_2.alpha = 0;numero_vita_elsa_1.alpha = 0;}
        else if (vita_elsa === 2 && olaf.x > 19800) {numero_vita_elsa_2.alpha = 0.98; numero_vita_elsa_5.alpha = 0; numero_vita_elsa_4.alpha = 0;numero_vita_elsa_3.alpha = 0;numero_vita_elsa_1.alpha = 0;}
        else if (vita_elsa === 1 && olaf.x > 19800) {numero_vita_elsa_1.alpha = 0.98; numero_vita_elsa_5.alpha = 0; numero_vita_elsa_4.alpha = 0;numero_vita_elsa_3.alpha = 0;numero_vita_elsa_2.alpha = 0;}

            if (olaf_colpito_flag === 1){

            }

            // Gestisco la prima bandierina del primo check-point facendola alzare e/o sventolare

            if ( olaf.x > 173 &&  olaf.x < 10354 && bandierina1_alzata === 0){
            bandierina1.animations.play('bandiera_sale',24, false); // era 12
            bandierina1_alzata = 1; livello_gioco = 1;
            musicacheckpoint.play();
            }

            else if (olaf.x > 360){bandierina1.animations.play('bandiera_sventola',10, false); //430 posizione originale
                bandierina1_alzata = 2;}

            else if (olaf.x < 360 && bandierina1_alzata === 2){bandierina1.animations.play('bandiera_sventola',10, false);}

        // Gestisco la seconda bandierina del secondo check-point facendola alzare e/o sventolare

            if ( olaf.x > 10463 && olaf.x < 19730 && bandierina2_alzata === 0){
                bandierina2.animations.play('bandiera_sale', 24, false);  //era 12
                bandierina2_alzata = 1; livello_gioco = 2;
                musicacheckpoint.play();
            }

            else if (olaf.x > 10650){bandierina2.animations.play('bandiera_sventola',10, false);  // era 10720
                bandierina2_alzata = 2;}

            else if (olaf.x < 10650 && bandierina2_alzata === 2){bandierina2.animations.play('bandiera_sventola',10, false);}


        // Gestisco la terza bandierina del terzo check-point facendola alzare e/o sventolare

        if ( olaf.x > 19719 && bandierina3_alzata === 0){   // 19822
            bandierina3.animations.play('bandiera_sale', 24, false);  //era 12
            bandierina3_alzata = 1; livello_gioco = 3;
            musicacheckpoint.play();
        }

        else if (olaf.x > 20009){bandierina3.animations.play('bandiera_sventola',10, false);  // era 10720
            bandierina3_alzata = 2;
            muro.body.enable = true;}

        else if (olaf.x < 20009 && bandierina3_alzata === 2){bandierina3.animations.play('bandiera_sventola',10, false);}


        // Disabilito il "collideWorldBounds" per permetere a Olaf di scivolare fuori dal gioco quando cade nei buchi .. GAME OVER"

        if ( olaf.y > 560 )   {
            olaf.body.collideWorldBounds = false;
            game.input.keyboard.removeKey(Phaser.Keyboard.SPACEBAR);
            // game.debug.text(" Olaf caduto ", 420, 350);
            }

        // Verifico se Olaf è caduto sotto il livello delle piattaforme di terra

        if ( olaf.y > 600 )   {

            olaf_dead();
        }

        // Gestisco le collisioni e gli overlap degli oggetti
        game.physics.arcade.collide(olaf, rovi, olaf_dead);
        game.physics.arcade.collide(olaf, spuntoni, olaf_dead);
        game.physics.arcade.collide(olaf, piattaforme_fisse);
        game.physics.arcade.collide(elsa, piattaforme_fisse);
        game.physics.arcade.collide(corona, piattaforme_fisse);
        game.physics.arcade.collide(olaf, mattoni);
        game.physics.arcade.collide(olaf, corona, prendi_corona);
        game.physics.arcade.collide(olaf, muro);
        game.physics.arcade.collide(elsa, muro);
        game.physics.arcade.collide(elsa, weapon.bullets, elsa_dead);
        game.physics.arcade.collide(weapon2.bullets,olaf, olaf_dead);
        game.physics.arcade.collide(olaf, trono_sotto, olaf_dead);
        game.physics.arcade.collide(olaf, trono_sopra, olaf_dead);
        game.physics.arcade.collide(olaf, elsa, olaf_dead);
        game.physics.arcade.collide(olaf, ponte);
        game.physics.arcade.collide(ghiaccio.bullets, ponte);
        game.physics.arcade.overlap(olaf, fiocchi, collect);
        //game.physics.arcade.overlap(olaf, ciapi, ciapamento);
        game.physics.arcade.overlap(olaf, fiocchi_livello3, collect);
        game.physics.arcade.collide(mattoni, piattaforme_fisse);
        game.physics.arcade.collide(mattoni, mattoni);
        game.physics.arcade.collide(ghiaccio.bullets, piattaforme_fisse);
        game.physics.arcade.collide(ghiaccio.bullets, muro);
        game.physics.arcade.collide(ghiaccio.bullets, olaf, ferma_ghiaccio_o);
        for (var i = 0; i < 6; i++) {game.physics.arcade.overlap(nemico[i], olaf, olaf_dead);}
        for (var i = 0; i < 6; i++) {game.physics.arcade.overlap(nemico[i], weapon.bullets, nemico_colpito);}
        for (var i = 0; i < 9; i++) {game.physics.arcade.collide(olaf, piattaforma_mobile[i],sgretola_piattaforma);}
        for (var i = 0; i < 9; i++) {game.physics.arcade.collide(ghiaccio.bullets, piattaforma_mobile[i]);}

        olaf.body.velocity.x = 0;

        // Gestione dei tasti destro e sinistro

        if (cursors.left.isDown && olaf.body.touching.down && !tasto_salta.isDown)
        {
          olaf.body.velocity.x = -260; // -180
          weapon.trackSprite(olaf,10,50,false);
          weapon.bulletSpeed = -800;
          direzione_olaf = "verso_sx";
          olaf.play('olaf_cammina_sx', 18, true);
          ghiaccio.trackSprite(olaf,-100,50,false);
          ghiaccio.bullets.setAll('body.velocity.x', 0);

        }

        else if (cursors.left.isDown && !olaf.body.touching.down)
        {
            olaf.body.velocity.x = -260; //-150
            direzione_olaf = "verso_sx";
            weapon.trackSprite(olaf,10,50,false);
            weapon.bulletSpeed = -800;
            olaf.play('olaf_cammina_su_sx', 5, true);
        }

        else if (cursors.right.isDown && olaf.body.touching.down && !tasto_salta.isDown)
        {
            olaf.body.velocity.x = 260; //180
            weapon.trackSprite(olaf,50,50,false);
            weapon.bulletSpeed = 800;
            direzione_olaf = "verso_dx";
            olaf.play('olaf_cammina_dx', 18, true)
            ghiaccio.trackSprite(olaf,100,50,false);
            ghiaccio.bullets.setAll('body.velocity.x', 0);
        }

        else if (cursors.right.isDown && !olaf.body.touching.down)
        { olaf.body.velocity.x = 260; //150
            weapon.trackSprite(olaf,50,50,false);
            weapon.bulletSpeed = 800;
            direzione_olaf = "verso_dx";
            olaf.play('olaf_cammina_su_dx', 5, true)
        }

        // Gestione del tasto salta

        else if (tasto_salta.isDown && vita_olaf > 0 && olaf.body.touching.down)
        { olaf.body.velocity.y = -390;
        }

        else if (tasto_salta.isDown && cursors.right.isDown && vita_olaf > 0 && olaf.body.touching.down)
        { olaf.body.velocity.y = -390;}

        else if (tasto_salta.isDown && cursors.left.isDown && vita_olaf > 0 && olaf.body.touching.down)
        { olaf.body.velocity.y = -390;}

        else if (!olaf.body.touching.down && !cursors.left.isDown && !cursors.right.isDown){
          olaf.play('olaf_cammina_su_centro', 4, true);
        }

        else
            {
                // Olaf è fermo (non sto schiacciando tasti)
                olaf.play('olaf_guarda_avanti', 10, true)
                olaf.animations.stop();
                ghiaccio.bullets.setAll('body.velocity.x', 0); // Impedisce al ghiaccio di muoversi

            }




                                if ((cursors.left.isDown||cursors.right.isDown)
                                && (olaf.body.touching.down||olaf.body.blocked.down) && (olaf.x < 9344))
                                    {ciff.play('', 0, .3, true, false)}
                                else {ciff.fadeTo(100, 0)}


                                if ((cursors.left.isDown||cursors.right.isDown)
                                && (olaf.body.touching.down||olaf.body.blocked.down) && (olaf.x > 9668))
                                    {secco.play('', 0, .3, true, false)}
                                else {secco.fadeTo(100, 0)}




        // Gestisco il movimento (cammino) delle Guardie tramite il loro limite dx e sx
        for (var i = 0; i < 6; i++)
        {
            if ( nemico[i].x > limite_dx_nemico[i])
            {
                nemico[i].x = limite_dx_nemico[i]-20;
                inverti_cammino("nemico",i);
            }
            if ( nemico[i].x < limite_sx_nemico[i])
            {
                nemico[i].x = limite_sx_nemico[i]+20;
                inverti_cammino("nemico",i);
            }
        }

            // Gestisco il tasto S (fire)
            if (fireButton.isDown && fireButton.duration < 3) {
                if (bullet_counter > 0){
                    if (weapon.fire ())
                        bullet_counter--
                    munizione[bullet_counter].alpha = 0.5;
                    palla.play();
                }
            }



            if (fireButton.isDown && cursors.left.isDown){
              olaf.play('olaf_sparasx', 2, false);
            }


            if (fireButton.isDown && cursors.right.isDown){
              olaf.play('olaf_sparadx', 2, false);
            }






            // Gestisco il tasto 0 (vittoria)
            if (vittoriaButton.isDown && fireButton.duration < 5) {
                window.open(url_endgame, '_self');
                }

            // Gestisco il tasto 9 (sconfitta)
            if (sconfittaButton.isDown && fireButton.duration < 5) {
                window.open(url_gameover, '_self');
                }

            // Gestisco il tasto D (cubetto_ghiaccio)
            if (cubettoButton.isDown && cubettoButton.duration < 3) {

                if (bullet_counter > 0){
                    if (ghiaccio.fire ())
                        bullet_counter -= 1;
                        munizione[bullet_counter].alpha = 0.5;
                    //ghiaccio.bullets.setAll('body.velocity.x', 0);
                    cubetto.play();

                                            }
                }




                if (cubettoButton.isDown && cursors.left.isDown){
                  olaf.play('olaf_sparasx', 2, false);
                }


                if (cubettoButton.isDown && cursors.right.isDown){
                  olaf.play('olaf_sparadx', 2, false);
                }


            // Gestisco il tasto 2 (salto al livello 2)
                if (livello2Button.isDown) {
                    olaf.x = 10350;
                    livello_gioco=2;
                }

            // Gestisco il tasto 3 (salto al livello 3)
                if (livello3Button.isDown) {
                    olaf.x = 19713;
                    livello_gioco = 3;
                }

            // Gestisco il tasto T (test)
                if (testButton.isDown) {

                    }

    }

        // funzione per la gestione del tempo vita di Olaf
        // vengono eseguiti alcuni check: la ricarica delle munizioni, la caduta di Olaf nel buco, l'arrivo del nemico al limite dx
        function tempo() {

            var timer = game.time.events.loop(1100, function () {

                if (olaf_reset === 1  && tempo_rimasto < tempo_totale_timer) {

                    // Ho preso un fiocco resetto il timer (loop) e lo faccio ripartire

                    olaf_reset = 0;

                    weapon = game.add.weapon(5, 'neve');
                    weapon.trackSprite(olaf,50,50,false);
                    weapon.fireAngle = 0;
                    weapon.bulletAngleVariance = 3;
                    weapon.bulletSpeed = 800;
                    weapon.fireLimit = 5;
                    weapon.fireRate = 240;

                    // Richiamo il loop ripartendo da capo con il tempo

                    tempo_rimasto = tempo_totale_timer;
                    timer.loop = false;
                    tempo();

                }
                else if (tempo_rimasto === 0) {olaf_dead();}

                else if (tempo_rimasto > 0)
                {
                    //  C'è ancora tempo ... Decremento il tempo totale
                    tempo_rimasto -= 1;

                    // Olaf incomicia però a svanire
                    olaf.alpha = olaf.alpha * 0.95;
                }

            });
        }


    // funzione chiamata quando il nemico collide con i boundaries del gioco
    function colpisco_world_boundaries () {

        inverti_cammino("nemico",0);

    }

    // funzione chiamata quando si risveglia il nemico dopo averlo colpito la prima volta
    function risveglia_nemico (e) {

        parametro = e;

        timer_stop_nemico[e].stop();
        timer_stop_nemico[e].destroy();

        if (nemico_si_muove[e] === "verso SX") {
            nemico[e].body.velocity.x = -75;
            colpi_subiti_nemico=0;
            nemico[e].animations.paused = 0;
            timer_stop_nemico[e] = game.time.create(false);
            timer_stop_nemico[e].loop(1500, risveglia_nemico, this, e);
        }
        else if (nemico_si_muove[e] === "verso DX")
        {

            nemico[e].body.velocity.x = 75;

        }
        nemico[e].animations.paused=0;
        colpi_subiti_nemico=0;
        timer_stop_nemico[e] = game.time.create(false);
        timer_stop_nemico[e].loop(1500, risveglia_nemico, this, e);
        }

    // funzione di inversione di un soggetto in movimento (paramtro della funzione) usata attualmente solo per nemico (la funzione per Elsa non è utilizzata in questa versione)
    function inverti_cammino(s,e) {


        if (s === "nemico") {
            // se il nemico si muoveva verso destra uso ora la sequenza di animazione verso sinistra
            if (nemico_si_muove[e] === "verso DX")
            {
                nemico[e].animations.play('nemico_cammina_verso_sx', 18, true);
                nemico[e].body.velocity.x=-75;
                nemico_si_muove[e] ="verso SX";
            }

            // se il nemico si muoveva da sinistra uso ora la sequenza di animazione verso destra
            else if (nemico_si_muove[e] === "verso SX")
            {
                nemico[e].animations.play('nemico_cammina_verso_dx', 18, true);
                nemico[e].body.velocity.x=75;
                nemico_si_muove[e] ="verso DX";
            }

                            }
        else if (s === "elsa") {
            elsa_flag = 8;
            // se il nemico si muoveva verso destra uso ora la sequenza di animazione verso sinistra
            if (elsa_si_muove === "verso DX")
            {
                elsa.animations.play('elsa_cammina_sx', 18, true);
                elsa.body.velocity.x = -75;
                elsa_si_muove ="verso SX";
            }

            // se il nemico si muoveva da sinistra uso ora la sequenza di animazione verso destra
            else if (elsa_si_muove === "verso SX")
            {
                elsa.animations.play('elsa_cammina_dx', 18, true);
                elsa.body.velocity.x = 75;
                elsa_si_muove ="verso DX";
            }

        }
    }

        // funzione chiamata quando una palla di neve (weapon) colpisce il nemico
        function nemico_colpito (n, b) {




            b.kill();
            suononeve.play('', 0, .16, false, true);

            // se è la prima volta che il nemico viene colpito la sua animazione viene messa in pausa (il nemico si ferma)
            if (colpi_subiti_nemico === 0) {
                suononeve.play('', 0, .2, false, false);

                n.body.velocity.x=0;
                n.animations.paused=1;

                // fermo il cammino del nemico per la durata del timer (4 secondi)

                if (n.x >= limite_sx_nemico[0] && n.x <= limite_dx_nemico[0]){
                timer_stop_nemico[0].start();
                colpi_subiti_nemico++;}


                else if (n.x >= limite_sx_nemico[1] && n.x <= limite_dx_nemico[1]){
                    timer_stop_nemico[1].start();
                    colpi_subiti_nemico++;}

                else if (n.x >= limite_sx_nemico[2] && n.x <= limite_dx_nemico[2]){
                    timer_stop_nemico[2].start();
                    colpi_subiti_nemico++;}

                else if (n.x >= limite_sx_nemico[3] && n.x <= limite_dx_nemico[3]){
                    timer_stop_nemico[3].start();
                    colpi_subiti_nemico++;}

                else if (n.x >= limite_sx_nemico[4] && n.x <= limite_dx_nemico[4]){
                    timer_stop_nemico[4].start();
                    colpi_subiti_nemico++;}

                else if (n.x >= limite_sx_nemico[5] && n.x <= limite_dx_nemico[5]){
                    timer_stop_nemico[5].start();
                    colpi_subiti_nemico++;}
            }

            // se il nemico viene colpito una seconda volta muore e sparisce dalla scena
            else {
                suononeve.play('', 0, .2, false, false);

                // il nemico è stato colpito una seconda volta mentre era fermo e viene ucciso
                b.kill();
                n.kill();

                if (n.x >= limite_sx_nemico[0] && n.x <= limite_dx_nemico[0]){
                    timer_stop_nemico[0].stop();
                    timer_stop_nemico[0].destroy();
                    colpi_subiti_nemico = 0}

                else if (n.x >= limite_sx_nemico[1] && n.x <= limite_dx_nemico[1]){
                    timer_stop_nemico[1].stop();
                    timer_stop_nemico[1].destroy();
                    colpi_subiti_nemico = 0}

                else if (n.x >= limite_sx_nemico[2] && n.x <= limite_dx_nemico[2]){
                    timer_stop_nemico[2].stop();
                    timer_stop_nemico[2].destroy();
                    colpi_subiti_nemico = 0}

                else if (n.x >= limite_sx_nemico[3] && n.x <= limite_dx_nemico[3]){
                    timer_stop_nemico[3].stop();
                    timer_stop_nemico[3].destroy();
                    colpi_subiti_nemico = 0}

                else if (n.x >= limite_sx_nemico[4] && n.x <= limite_dx_nemico[4]){
                    timer_stop_nemico[4].stop();
                    timer_stop_nemico[4].destroy();
                    colpi_subiti_nemico = 0}

                else if (n.x >= limite_sx_nemico[5] && n.x <= limite_dx_nemico[5]){
                    timer_stop_nemico[5].stop();
                    timer_stop_nemico[5].destroy();
                    colpi_subiti_nemico = 0}
            }
        }


        // funzione ciapa
        //function ciapamento (o, c) {
        //c.animations.play('ciapata', 10, false, true);
        //}



        // funzione chiamata quando Olaf collide con i fiocchi
        function collect (o, f) {

            f.kill();
            o.alpha = 1;
            // ogni fiocco preso diventa una munizione per olaf
            if (bullet_counter < 5) {munizione[bullet_counter].alpha = 1;}
            if (bullet_counter <= 4) {bullet_counter++;}
            olaf_reset = 1;
            tempo_rimasto = tempo_totale_timer ;
            vita.animations.stop('barra');
            vita.animations.play('barra', tempo_scioglimento_barra, true);
            blink.play()

        }

        // funzione chiamata quando Elsa viene colpita da Olaf
        function elsa_dead(e, b) {
            suononeve.play('', 0, .2, false, true);
            b.kill();
            colpi_subiti_elsa++;
            vita_elsa--;
            if (colpi_subiti_elsa === 5) {
                // animazione elsa
                elsa.animations.stop();
                elsa.animations.play('elsa_inchino_sx',4, false);
                weapon2.autofire = false;
                // faccio apparire (cadere dall'alto) la corona
                corona.x = 20605;
                corona.y = 0;
                corona.body.gravity.y = 400;
                corona.body.velocity.y = 100;
                weapon2.autofire = false;
            }
        }

        function prendi_corona(o,c) {

                c.kill();

                // chiamo la pagina di vittoria
                window.open(url_endgame, '_self');
        }


        // funzione chiamata quando Olaf viene colpito dal nemico
        function olaf_dead(n, o) {
            olaf_colpito_flag = 0;

            timer[0] = game.time.create(false);
            timer[1] = game.time.create(false);
            timer[2] = game.time.create(false);
            timer[3] = game.time.create(false);
            timer[4] = game.time.create(false);
            timer[5] = game.time.create(false);
            timer[6] = game.time.create(false);
            timer[7] = game.time.create(false);
            timer[8] = game.time.create(false);


            timer[0].add(2000, function (){
                piattaforma_mobile[0].body.velocity.y = 0;
                piattaforma_mobile[0].y = piattaforma_mobile_ordinate[0];
                piattaforma_mobile[0].body.immovable = true;
                piattaforma_mobile[0].body.allowGravity = false;
                piattaforma_mobile[0].animations.play('piattaforma_ferma',1, false);
                }, this);
            timer[0].start();

            timer[1].add(2000, function (){
                piattaforma_mobile[1].body.velocity.y = 0;
                piattaforma_mobile[1].y = piattaforma_mobile_ordinate[1];
                piattaforma_mobile[1].body.immovable = true;
                piattaforma_mobile[1].body.allowGravity = false;
                piattaforma_mobile[1].animations.play('piattaforma_ferma',1, false);
                }, this);
            timer[1].start();

            timer[2].add(2000, function (){
                piattaforma_mobile[2].body.velocity.y = 0;
                piattaforma_mobile[2].y = piattaforma_mobile_ordinate[2];
                piattaforma_mobile[2].body.immovable = true;
                piattaforma_mobile[2].body.allowGravity = false;
                piattaforma_mobile[2].animations.play('piattaforma_ferma',1, false);
                }, this);
            timer[2].start();

            timer[3].add(2000, function (){
                piattaforma_mobile[3].body.velocity.y = 0;
                piattaforma_mobile[3].y = piattaforma_mobile_ordinate[3];
                piattaforma_mobile[3].body.immovable = true;
                piattaforma_mobile[3].body.allowGravity = false;
                piattaforma_mobile[3].animations.play('piattaforma_ferma',1, false);
                }, this);
            timer[3].start();

            timer[4].add(2000, function (){
                piattaforma_mobile[4].body.velocity.y = 0;
                piattaforma_mobile[4].y = piattaforma_mobile_ordinate[4];
                piattaforma_mobile[4].body.immovable = true;
                piattaforma_mobile[4].body.allowGravity = false;
                piattaforma_mobile[4].animations.play('piattaforma_ferma',1, false);
                }, this);
            timer[4].start();


            gestisci_end_of_life(n, o);

        }

        function gestisci_end_of_life(n, o) {
          //olafspuntonato.play('', 0, .16, false, false);

        if (olaf_colpito_flag === 0) {

                //olaf_colpito_flag = 1;

                bandierina1.animations.stop();
                bandierina1_alzata = 0;
                bandierina1.animations.play('bandiera_ferma', 7, false);

                bandierina2.animations.stop();
                bandierina2_alzata = 0;
                bandierina2.animations.play('bandiera_ferma', 7, false);

                bandierina3.animations.stop();
                bandierina3_alzata = 0;
                bandierina3.animations.play('bandiera_ferma', 7, false);


                for (var i = 0; i < 5; i++)
                {
                    munizione[i].alpha = 0.5;
                }
                bullet_counter = 0;

                for (var i = 0; i < 19; i++)
                {
                    //  Ri-Creo i fiocchi nel gruppo (in posizione pre-determinata dalle costanti fiocco_ascisse e fiocco_ordinate)
                    fiocco[i].reset(fiocco_ascisse[i], fiocco_ordinate[i]);

                }

                    fiocco_l3[0].reset(19800, 520);

                for (var i = 1; i < 8; i++)
                {
                    //  Ri-Creo i fiocchi del livello 3 nel gruppo (in posizione random)

                    fiocco_l3[i].reset(fiocco_l3_ascisse[i], fiocco_l3_ordinate[i]);

                }

                // per ciapamenti
                //for (var i = 0; i < 17; i++)
                //{
                //ciapa[i].reset(ciapa_ascisse[i], ciapa_ordinate[i]);
                //ciapa[i].animations.stop('ciapata', 1, false, true);
                //}



                // Ri-Creo Stalattiti
            for (var i = 0; i < 2; i++) {
                lampadario_cadente[i].reset(lampadario_cadente_ascisse[i], lampadario_cadente_ordinate[i]);
                lampadario_cadente[i].body.gravity.y = 0;
            }

                for (var i = 0; i < 5; i++)
                {
                    //  Ri-Creo i nemici nel gruppo (in posizione pre-determinata dalle costanti nemico_ascisse e nemico_ordinate)
                    nemico[i].reset(nemico_ascisse[i], nemico_ordinate[i]);
                    inverti_cammino('nemico', i);

                }
                olaf.body.collideWorldBounds = true;
                olaf.body.gravity.y = 440;
                tasto_salta = game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);
                olaf_reset = 0;
                tempo_rimasto = tempo_totale_timer;
                timer.loop = false;
                vita.animations.stop('barra');
                vita.animations.play('barra', tempo_scioglimento_barra, true);
                olaf.alpha = 1;
                cubetto_corrente = 0;
                ghiaccio.bullets.setAll('body.y', 900);
                ghiaccio.bullets.setAll('body.velocity.y', 0);

                // Vita persa di Olaf trasporto al check-point del livello raggiunto
                if (vita_olaf > 1) {
                    vita_olaf -= 1;
                    if (livello_gioco === 0) {trasporta_olaf(20, 400); livello_gioco=0;}
                    else if (livello_gioco === 1) {trasporta_olaf(20, 400); livello_gioco=1;}
                    else if (livello_gioco === 2) {trasporta_olaf(10354, 400); livello_gioco=2;}
                    else if (livello_gioco === 3){trasporta_olaf(19720, 400); livello_gioco=3;}

                }
                else
                    //game_over();                // da commentare o cancellare quando la pagina sarà disponibile
                    link_per_game_over();     // da scommentare quando la pagina sarà disponibile .. chiama la pagina di "sconfitta"
            }

        }

        //function delete_bullet(w, o) {
        //  w.kill();
        //}


        // Funzione chiamata per riposizionare Olaf
        function trasporta_olaf(o,a) {

            olaf.y = a;
            olaf.x = o;
        }

        // chiama la pagina di vittoria
        function link_per_game_over(){

            window.open(url_gameover, '_self');

        }

        // Funzione chiamata quando finisce il gioco per fine vite Olaf (usato temporaneamente chiamato dalla funzione 'gestisci_end_of_life', vedi commento nella funzione)
        // Non verrà utilizzato quando si finirà il gioco chiamando la pagina di "sconfitta"

        function game_over(w, n, o) {


            // Kill di Olaf e della barra della vita inoltre azzero il contatore delle munizioni
            if (w === 'aspetta'){

                var aspetta = game.time.events.loop(1500, function () {
                   text.setText("          ");
                   bullet_counter=0;
                   vita.kill();
                   olaf.kill();

                    for (var i = 0; i < 7; i++)
                    {
                   nemico[i].kill();}

                   // visualizzo la scritta GAME OVER!

                   game.add.text(game.camera.x + 425, game.camera.y + 350, " GAME OVER!", {fill:"white", font:'Comic Sans MS', fontSize:"32px"});

                });
            }
            else {
            text.setText("          ");
            bullet_counter=0;
            vita.kill();
            olaf.kill();

            for (var i = 0; i < 6; i++) {nemico[i].kill();}

            // visualizzo la scritta GAME OVER!

            game.add.text(game.camera.x + 425, game.camera.y + 350, " GAME OVER!", {fill:"white", font:'Comic Sans MS', fontSize:"32px"});
        }
                }

        // Funzione necessaria a fermare i blocchetti di ghiaccio alla loro creazione permettendo comunque a Olaf di spostarli successivamente (funzione per Olaf)
        function ferma_ghiaccio_o(o,p) {

            ghiaccio.bullets.setAll('body.velocity.x', 0);
            ghiaccio.bullets.setAll('body.velocity.y', 0);

                }
        // Funzione necessaria a fermare i blocchetti di ghiaccio alla loro creazione permettendo comunque a Olaf di spostarli successivamente (funzione per la Guardia)
        function ferma_ghiaccio_n(n,p) {

                if (nemico_si_muove === "verso_sx") {p.body.velocity.x = -50;}
                else if (nemico_si_muove ==="verso_dx") {p.body.velocity.x = -50;}

                }
        // Funzione per lo sgretolamento della piattaforma mobile (avviene i due tempi: 1) animazione 2) posizionamento della piattaforma "fuori dal gioco")
        function sgretola_piattaforma (o, p) {
        cadutaterre.play('', 0, .6, false, false);
            p.animations.play('piattaforma_si_rompe', 3, false);
            o.body.velocity.y = 300; //550
            aspetta = game.time.create(false);
            aspetta.add(2000, function () {p.body.y = 200;
                                         p.body.velocity.y = 400;  //215
                                         p.body.immovable = false;
                }, this);

            aspetta.start();

                }




        // Funzione di creazione dei mattoni in posizione random intorno a x = 19580
        function mattoni_cadenti(i){

            posizione_mattone = (Math.floor(Math.random() *36) +0);

            if (i==1){
                mattone = mattoni.create(19580 + posizione_mattone, 0, 'mattone');
                mattone.body.gravity.y = 100;
                mattone.body.velocity.y = 1000;
                mattone.body.velocity.x = 0;} else if (i==2)

            {	//mattone = mattoni.create(Math.floor(Math.random() * 45), 0, 'mattone');
                mattone = mattoni.create(85, 500, 'mattone');
                mattone.body.gravity.y = 150;} else if (i==3)

            {	//mattone= mattoni.create(Math.floor(Math.random() * 45), 0, 'mattone');
                mattone = mattoni.create(100, 100, 'mattone');
                mattone.body.gravity.y = 100;}else

            {	//mattone = mattoni.create(Math.floor(Math.random() * 45), 0, 'mattone');
                mattone = mattoni.create(250, 200, 'mattone');
                mattone.body.gravity.y = 50;}

            mattone.body.immovable = false;
            mattone.body.collideWorldBounds = true;

        }
        // Funzione per evitare che i mattoni vengano spostati quando colpiti da Olaf
        function blocca_mattoni(mattone) {

            body = mattone.body;
            if (body.moves && (body.blocked.down || body.touching.down) && Math.abs(mattone.deltaY) < 1)
            //if (body.moves && (body.blocked.down || body.touching.down) < 1)
                {
                body.immovable = true;
                body.moves = false;
                body.speed = 0;
                body.velocity.set(-25);
                body.checkCollision.top = false;
                body.velocity.x = 0;
                }


            }







        function render() {
            //game.debug.spriteInfo(lampadario_cadente[0], 332, 23);
            //game.debug.spriteInfo(olaf, 332, 103);
            //game.debug.spriteInfo(elsa, 332, 103);
            //game.debug.text(" Elsa Colpita : " + colpi_subiti_elsa, 20, 350);
            //game.debug.text(" Flag di Elsa: " + elsa_flag + "  Posizione di Elsa : " + elsa.x, 20, 380);
            //game.debug.text("Vite Olaf rimaste : " + vita_olaf, 20, 350);
            //game.debug.text(" Livello : " + livello_gioco, 20, 350);
            //game.debug.text("Colpi in canna  : "+ bullet_counter, 20, 350);
            //game.debug.text("Nemico  : "+ carattere + "    " + nemico[6], 20, 350);
            //game.debug.text(" Piattaforme ricreate : " + conta_loop_ricrea, 20, 350);
            //game.debug.text("Sgretolamenti : " + conta_sgretola + "    Olaf Colpito flag   " +  olaf_colpito_flag , 20, 450);
        }
    </script>
</body>
</html>
